axpdf.spi	Ver. 1.15

・概要
PDF/XPSを書庫として扱い、ページ毎のBMPを出力するsusieプラグイン
Windows 7 64bit上の あふw(32bit) でのみ動作確認
http://mimizunoapp.appspot.com/
http://mimizuno.blog76.fc2.com/

MuPDFをバックエンドに使用
正確にはSumatraPDF用に若干改変されたMuPDFを使用している。
SumatraPDFのソースに含まれている。
改変部分が必要だったわけじゃないけど、一つにまとめられたlibを出力しやすいmakefileが入っていたので使用。
おそらくSumatraPDFで表示出来ているものなら同様の表示結果が得られるはず。
SumatraPDFではPDF/XPS以外のフォーマットも表示出来るがこれはPDFとXPSのみに対応。
パスワード入力ダイアログを作るのが面倒なため、いまのところその場でのパスワード入力は非対応。
iniファイルにパスワードの一覧をつくっておくことでパスワード付きpdfを開くことは可能
正常に表示されないPDFがあったらブログのコメントにでも書いて欲しい。
	可能ならそのPDFを入手する方法が書いてあればうれしい。

ライセンスはGPLv3
	MuPDFがGPLv3となっているのでそれを見ながら書いたこれもGPLになると思うのだけど、
	susieプラグインの雛形部分までGPL汚染されるのだろうか。
	このページで言われているようにGPLなsusieプラグインはGPLなビューアじゃなきゃライセンス上問題あるかも
		http://yak-ex.blogspot.com/2012/02/susie-gpl.html

・設定
以下のような内容でaxpdf.iniをaxpdf.spiと同じフォルダに置くことで設定
Susieプラグインとしての設定ダイアログは無い

[Setting]
DPI=96
[Password]
PASS0 = pdfpass
PASS1 = pdfpass including space

DPIにはJPEGファイルのDPIを指定(iniが無い時のデフォルトは144)
Passwordセクションには「PASSx=パス」という書式でpdfに使われるパスワードを指定
	xは0,1,2,3,...,10,11,12といった感じの数値(0からの連番にすること。PASS00ではなくPASS0とする。)
	パスワード付きのPDFを開くときここからひとつずつ試行していき一致したら開かれる

プラグインファイルの名前を変更したら設定ファイル名も変わる(axpdf_.spiとしたらaxpdf_.iniで設定)
	プラグインの拡張子は.spiから変更しないこと
よく使うDPIごとにプラグインとiniを複製しておいて
"DPI144" &S_ARC axpdf_dpi144.spi
"DPI96" &S_ARC axpdf_dpi96.spi
"DPI72" &S_ARC axpdf_dpi72.spi
のようなメニューを あふw で作っておけば、ざっと確認や詳細に見たいときに切り替えできる。
	出来るといっても上のようなことはしないかもしれないが、
	プラグインのファイル名を変えたときに設定ファイル名も変わるということに注意。

・コンパイルするには
OMakeを用意
VCにパスの通ったコマンドプロンプトを開く
ディレクトリを用意
そこにSumatraPDF 2.2.1のソースを展開する
	http://code.google.com/p/sumatrapdf/downloads/list から取得
そこにsrc.zipを展開する
omakeを実行

・更新履歴
Ver 1.15 2013-01-15
	BITMAPINFOHEADERのbiSizeImageがファイルサイズになっていなかったのを修正
Ver 1.14 2013-01-13
	SumatraPDF-2.2.1ベースに更新。
	biXPelsPerMeter, biYPelsPerMeterに0を入れるように。
		あまり再現性のなかった強制終了はこれで解決されたかも。
Ver 1.13 2012-05-09
	SumatraPDF-2.1.1ベースに更新。
	MuPDF内でファイル名がUTF-8だと決めつけてるような処理が追加されたので変換して渡すように。
Ver 1.12 2012-04-15
	SumatraPDF-2.0.1ベースに更新。
	MuPDFのAPIが大きく変更されていたので修正。
	ついでにXPSも表示出来るようにしてみた。
		手元にないので確認はしていないがCBZ形式も表示出来るかも。
Ver 1.11 2012-03-13
	壊れたPDFに対してのエラー処理に見落としがあったのを修正。
	SumatraPDF-1.9ベースに更新。
Ver 1.10 2011-11-15
	ページサイズの取得に問題があったため、多くのPDFが見られなくなっていたのを修正。
Ver 1.9 2011-11-08
	ページごとにサイズが異なるpdfに対応
Ver 1.8 2011-10-13
	SumatraPDF-1.8ベースに更新
Ver 1.7 2011-09-26
	正常時のハンドル開放忘れを修正
Ver 1.6 2011-09-20
	BMPのRGB配列を間違って出力していたため、赤と青が反転していたのを修正。
Ver 1.5 2011-09-04
	BMPヘッダのbiClrUsedとbiClrImportantにゴミデータが入っていたみたいなので0にした。
	ついでにbiSizeImageを与えるようにした。(Irfanviewによる出力と同等にしてみた)
		Leeyes単独でのBMP表示が出来るようになったことを確認
Ver 1.4 2011-08-28
	JPEG出力でなくBMP出力に変更。快適な速度になった。
	キャッシュファイルは作らなくしたのでその設定も削除。
Ver 1.3 2011-08-10
	テンポラリフォルダを使用する設定にすると、プラグインの初期化に失敗することがあるのを修正。
		あふw でプラグインはあるのにLibrary Not Foundとなる状態。
Ver 1.2 2011-07-25
	エラー時のハンドルの開放忘れを修正
	キャッシュファイルの保存先を設定可能に
	iniファイルにパスワードを指定する形でのパスワードpdfに対応
	キャッシュを使っているようで使っていなかったのを修正
Ver 1.1 2011-07-23
	ハンドル等の開放しわすれを修正
	キャッシュファイルにjpegを保存するようにした
Ver 1.0 2011-07-22
	使えるレベルのもの
	pdf名をプラグイン内に埋めこんでいたので差し替え
